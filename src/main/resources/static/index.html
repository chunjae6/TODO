<!DOCTYPE html>
<html>
    <head>
        <title>ToDoList</title>
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    </head>
    <body>
        <section id="app">
            <h1>{{ title }}</h1>
            <p v-html="contents"></p>
            <button @click="list" class="btn btn-primary">listing</button>

            <form @submit.prevent="save" method="post" class="py-5" action="/blog/save">
                <div>
                    <label>title</label>
                    <input class="form-control" type="text" v-model="post.title">
                </div>
                <div>
                    <label>contents</label>
                    <textarea class="form-control" v-model="post.contents"></textarea>
                </div>
                <button class="btn btn-primary">Save</button>
            </form>

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>id</th>
                        <th>title</th>
                        <th>contents</th>
                        <th>created</th>
                        <th>updated</th>
                        <th>buttons</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="row in blogList">
                        <td>{{ row.id }}</td>
                        <td>{{ row.title }}</td>
                        <td>{{ row.contents }}</td>
                        <td>{{ row.created }}</td>
                        <td>{{ row.updated }}</td>
                        <td>
                            <a @click.prevent="edit(row)" class="btn btn-sm btn-primary" href="#edit">edit</a> 
                            <a @click.prevent="remove(row.id)" class="btn btn-sm btn-danger" href="#delete">delete</a> 
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>

<script>
Vue.createApp({
    data() {
        return {
            title: '<b>Blog</b>',
            contents: '<b>this is Blog</b>',
            blogList: [],
            post: {
                title: "",
                contents: "",
            }
        };
    },
    mounted() {
        this.list();
    },
    methods: {
        list() {
            $.get('/blog/')
            .done( res => {
                this.blogList = res;
                this.blogList.forEach( row => row.created = row.created.substring(0,10));
            });
        },
        save() {
            $.post('/blog/save', this.post)
            .done( res => {
                this.post = { title: '', contents: '' };
                this.list();
            });
        },
        edit(row) {
            this.post = row;
        },
        remove( id ) {
            $.get('/blog/delete', { id: id })
            .done( res => { this.list() });
        }
    }
}).mount('#app');
</script>

    </body>
</html>